<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Installation</title>
    <link rel="stylesheet" type="text/css" href="../style/library.css" />
</head>
<body>
    <h1>Installation</h1>
	
    <div class="toc">
        1 <a href="#windows">Installation on Windows</a><br />
        &nbsp;&nbsp;&nbsp;&nbsp;1.1 <a href="#prerequisites">Prerequisites</a><br />
        &nbsp;&nbsp;&nbsp;&nbsp;1.2 <a href="#cmajor-installation">Cmajor installation</a><br />
        &nbsp;&nbsp;&nbsp;&nbsp;1.3 <a href="#llvm">LLVM installation</a><br />
        &nbsp;&nbsp;&nbsp;&nbsp;1.4 <a href="#mingw">Mingw-w64 installation</a><br />
        &nbsp;&nbsp;&nbsp;&nbsp;1.5 <a href="#visual-studio">Visual Studio installation</a><br />
        &nbsp;&nbsp;&nbsp;&nbsp;1.6 <a href="#uninstall.cmajor">Uninstalling Cmajor</a><br />
    </div>
	
    <h2 id="windows">
        1 Installation on Windows
    </h2>
	
	<h3 id="prerequisites">1.1 Prerequisites</h3>
	
	<ul>
		<li><a href="#llvm">LLVM</a></li>
		<li><a href="#mingw">Mingw-w64</a></li>
        <li><a href="#visual-studio">Visual Studio 2022 Community Edition</a></li>
	</ul>

    <h3 id="cmajor-installation">
        1.2 Cmajor installation
    </h3>

	<p>
		<strong>Note</strong>: If you have a previous Cmajor version installed, you should uninstall it before installing this version.
		Also in this case check also from the task manager, if you have "cmpms" process running. If you have, you should stop it before running the installation.
		The "cmpms" process is the Cmajor port map server that is normally left running when cmcode IDE has been run.
	</p>

    <p>
        <a href="https://sourceforge.net/projects/cmajor/files/5.0.0/cmajor-5.0.0-win-x64-setup.exe">Download</a> the setup program and run it.
        You can specify installation directory that is by default <b>C:\cmajor</b>.
        Note: the compiler needs write access to installation directory and its subdirectories,
        so C:\Program Files\ is not a good place to install.
        The setup creates an environment variable CMAJOR_ROOT that points to the installation directory
        and adds the CMAJOR_ROOT\bin directory to PATH. The setup adds a shortcut to the <em>Cmajor Code</em>
        (IDE) to the desktop. The CMAJOR_ROOT environment variable is used by the Cmajor tools to locate Cmajor Unicode database and 
		system library source and binary files.
    </p>

    <img src="image/cmajor_installation.png" />
	
	<p>
		The 'Containing directory' is a directory that will contain the installation directory. 
		You can change it by clicking the '...' button on the right and selecting a directory from a folder dialog,
		or by typing a directory path to the 'Containing directory' text box. 
		The installation directory is changed appropriately when changing the containing directory.
		The name of the installation directory is by default 'cmajor' but can be changed to any name.
	</p>
	
    <h3 id="llvm">
        1.3 LLVM installation
    </h3>

    <p>
        <ul>
            <li>
				
                Download <a href="https://github.com/llvm/llvm-project/releases/download/llvmorg-18.1.8/clang+llvm-18.1.8-x86_64-pc-windows-msvc.tar.xz">CLANG+LLVM 18.1.8 or later for Windows (64-bit)</a>.<br/>
                Insert the bin directory of the LLVM tools to the PATH environment variable so that Cmajor compiler can find clang++.exe and llvm-rc.exe from there.
            </li>
        </ul>
    </p>

    <h3 id="mingw">
        1.4 Mingw-w64 installation
    </h3
   
    <p>
        <ul>
            <li>
                Goto <a href="https://winlibs.com/#download-release">WinLibs download page</a> and 
                download the 
                <a href="https://github.com/brechtsanders/winlibs_mingw/releases/download/14.1.0posix-18.1.8-12.0.0-ucrt-r3/winlibs-x86_64-posix-seh-gcc-14.1.0-mingw-w64ucrt-12.0.0-r3.7z">GCC 14.1.0 Win64 without LLVM/Clang/LLD/LLDB package</a>.
            </li>
            <li>
                Extract it for example to the <strong>C:\mingw64</strong> folder.
            </li>
            <li>
                Insert the <strong>C:\mingw64\bin</strong> directory
                to the PATH environment variable, so that cppcmc and cmbs can find <strong>g++</strong> and cmdb can find <strong>gdb</strong> from there.
                Note: the package may contain also <strong>clang++.exe</strong> that is a Mingw-w64 toolchain version of the Clang++ compiler. However the Cmajor compiler expects to find the 
                x64_64-pc-windows-msvc version of the <strong>clang++.exe</strong>, so add the <strong>C:\mingw64\bin</strong> path after the <strong>CLANG+LLVM 18.1.8</strong> path.
                You can execute command <strong>clang++ --version</strong> from the command prompt: it should print <br/>
                clang version 18.1.8<br/>
                Target: x86_64-pc-windows-msvc
            </li>
        </ul>
    </p>

    <h3 id="visual-studio">
        1.5 Visual Studio installation
    </h3>
    
    <p>
        <ul>
            <li>Install Visual Studio (at least) Community Edition 2022 with C++ desktop workflow enabled.</li>
            <li>Open the file location of the <strong>x64 Native Tools Command Prompt for VS 2022</strong> shortcut and select its properties.</li>
            <li>Insert the path of the <strong>vcvars64.bat</strong> after the %comspec% /k text to the <strong>cmajor/config/masm.config.xml</strong> file as the value of the <strong>path</strong> attribute of the <strong>vcvars64</strong> element.
                The default path is <strong>C:\Program Files\Microsoft Visual Studio\2022\Community\VC\Auxiliary\Build\vcvars64.bat</strong>
				The MASM backend of the Cmajor compiler calls the vcvars64.bat and executes the <strong>msbuild.exe</strong> to compile generated asm files and link programs.
            </li>
        </ul>
    </p>

	<h3 id="uninstall.cmajor">1.6 Uninstalling Cmajor</h3>
	
	<p>
		Cmajor can be uninstalled from the Windows Control Panel | Add/Remove Programs section.
	</p>
	
	<p>
		When clicking the remove installation button, the Cmajor uninstaller program is started:
	</p>
	
	<img src="image/cmajor_uninstallation.png"/>
	
	<p>
		The uninstaller:
		<ul>
			<li>Stops the <strong>cmpms</strong> (port map server) process.</li>
			<li>Removes Cmajor Code program shortcut from the desktop.</li>
			<li>Removes the Start Menu/Programs/Cmajor folder.</li>
			<li>Restores the old value of CMAJOR_ROOT environment variable.</li>
			<li>Removes the &ltinstallation directory>/bin directory from PATH.</li>
			<li>Removes installed files that have not been changed. 
				The uninstaller will not remove files that the installer did not install.</li>
			<li>Schedules the removal of the uninstaller program on reboot.</li>
			<li>Schedules the removal of the installation directory on reboot. 
			The installation directory will not be removed unless it is empty.</li>
			<li>Removes Cmajor installation information from the Windows registry.</li>
		</ul>
	</p>

</body>
</html>
